#!/bin/bash

########################################################################################################################
########################################################################################################################

THIS_SCRIPT=${BASH_SOURCE[0]:-$0}

while [[ -n $(readlink "${THIS_SCRIPT}") ]]
do
  THIS_SCRIPT=$(readlink "${THIS_SCRIPT}")
done

AMI_HOME=$(cd $(dirname "${THIS_SCRIPT}") && pwd)/..

########################################################################################################################
########################################################################################################################

RED='\033[0;31m'
GREEN='\033[0;32m'
BLUE='\033[0;34m'
NC='\033[0m'

########################################################################################################################

function _line()
{
  echo -e "${BLUE}-----------------------------------------------------------------------------${NC}"
}

########################################################################################################################

function _box()
{
  _line
  echo -e "${BLUE}- $1${NC}"
  _line
}

########################################################################################################################

function _ok()
{
  echo -e "                                                                       [${GREEN}OKAY${NC}]"
  #### #
}

########################################################################################################################

function _err()
{
  echo -e "                                                                       [${RED}ERR.${NC}]"
  exit 1
}

########################################################################################################################
########################################################################################################################

_box "Updating '\${AMI_HOME}/webapps/AMI.war'"

(
  rm -fr "${AMI_HOME}/webapps/AMI/"

  mv "${AMI_HOME}/webapps/AMI.war" "${AMI_HOME}/webapps/AMI.war.old"

  curl -L https://repo.ami-ecosystem.in2p3.fr/releases/net/hep/ami/AMICoreWeb/1.0.0/AMICoreWeb-1.0.0.war > "${AMI_HOME}/webapps/AMI.war"

  _ok

) || _err

########################################################################################################################
########################################################################################################################
